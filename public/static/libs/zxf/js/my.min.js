!function(s){"use strict";var my={init:function(){my.form();my.backToTop();my.tips();my.stop_jump()},fn:{},obj:{},_data:{layerLastIndex:0,},getData:function(key){return my._data["my_"+key]||window.sessionStorage.getItem("my_"+key)},setData:function(key,value){window.sessionStorage.setItem("my_"+key,value);return my._data["my_"+key]=value},setCurrentPageFull:function(){try{setTimeout(function(){my.getData("layerLastIndex")&&layer.full(my.getData("layerLastIndex"))},300)}catch(error){}},form:function(){var form;if(arguments.length>0){form=[];for(i=0;i<arguments.length;i++){form[i]=arguments[i]}}else{form=$("form").not(".form-commonsearch, .unbind-form")}$(form).unbind();if(form){var form_length=form.length;for(var index=0;index<form_length;index++){$(form[index]).unbind();$(form[index]).find("[type=submit]").unbind();if(typeof($(form[index]).attr("forbid_ajax"))!=="undefined"){if(($(form[index]).attr("forbid_ajax"))!=="false"){continue}}var _hasRun=false;function _submit_event(_this,e){e.preventDefault();if(_hasRun===true){return false}_hasRun=true;$(_this).find(":submit").attr("disabled","disabled");$(_this).find("button[type=submit], input[type=submit]").prop("disabled","disabled");setTimeout(function(){_hasRun=false;$(_this).find(":submit").attr("disabled",false);$(_this).find("button[type=submit], input[type=submit]").prop("disabled",false)},1000);var this_form=$(_this).parents("form").length>0?$(_this).parents("form"):form;if(my.unbind_form){return false}return my.formSubmit($(this_form),e)}$(form[index]).find("[type=submit]").click(function(e){e.preventDefault();var _this=this;return _submit_event(_this,e)});$(form[index]).on("submit",function(e){e.preventDefault();var _this=this;return _submit_event(_this,e)})}}return false},formSubmit:function(form,e){e&&e.preventDefault();var form_url=form.attr("action");form_url=form_url?form_url:location.href;if(typeof(form_before)==="function"){if(form_before(e)===false){e.preventDefault();return false}}var formdata=my.getFormData(form);var validate=my.formValidate(form);if(validate===false){return false}var index=layer.msg("请稍后……",0);my.ajax(form_url,formdata,function(succ){if(succ.code===200){layer.msg(succ.message)}else{if(succ.code===500&&!succ.message){layer.msg("系统异常:请与管理员联系")}else{layer.msg(succ.message)}}if(typeof(form_after)==="function"){if(form_after(succ)===false){e&&e.preventDefault();return false}}succ.wait=succ.wait?succ.wait:3;try{if(typeof succ.close!=="undefined"&&succ.close===1){setTimeout(function(){layer.close(index);parent.layer.close(my.getData("layerLastIndex"))},succ.wait*1000)}}catch(err){return false}if(!my.isEmpty(succ.url)){setInterval(function(){window.location.href=succ.url},succ.wait*1000)}},function(errorMsg,err){if(typeof(form_after)==="function"){form_after(err)}return false})},getFormData:function(form){var formDataObj=new FormData();var upFile=false;$(form).find(":file").each(function(i,v){if(my.isEmpty($(v).attr("name"))===false){upFile=true;formDataObj.append($(v).attr("name"),my.isEmpty($(v)[0].files[0])?"":$(v)[0].files[0])}});if(upFile){var formdata=form.serializeArray();$.each(formdata,function(){formDataObj.append(this.name,this.value)});return formDataObj}else{return form.not(":file").serialize()}},formValidate:function(formEle,isFormEle){formEle=formEle?formEle:"form";isFormEle=(isFormEle===undefined)?true:isFormEle;var form;if(isFormEle){form=$(formEle)}else{form=$(formEle).parents("form")}$("").removeClass("is-invalid");var issuccess=true;$(form).find("input,textarea,select").each(function(i,v){var ele_type=$(this).attr("type");if(ele_type==="radio"||ele_type==="checkbox"){var checked_val=$("input[name=\""+$(this).attr("name")+"\"]:checked").val();if(my.regExpFormValidate(checked_val,$(this).data("rule"),$(this))===false){$(this).addClass("is-invalid");my.backToDom($(this));issuccess=false;layer.msg("请勾选表单选项");return false}else{issuccess=true;return true}}if(ele_type==="file"){try{$(this).get(0).files[0].size;issuccess=true;return true}catch(e){var reg_exp_str=$(this).data("rule");if(!my.isEmpty(reg_exp_str)){var checkArr=reg_exp_str.split("|");if(($.inArray("required",checkArr)>-1)&&my.isEmpty($(this).data("value"))){$(this).addClass("is-invalid");my.backToDom($(this));issuccess=false;layer.msg("请上传指定的文件");return false}if(my.regExpFormValidate($(this).data("value"),$(this).data("rule"),$(this))===false){$(this).addClass("is-invalid");my.backToDom($(this));issuccess=false;layer.msg("文件验证失败");return false}}issuccess=true;return true}}$(this).removeClass("is-invalid");if($(this).data("rule")!==undefined&&!$(this).is(":hidden")&&!my.isEmpty($(this).data("rule"))){if(my.regExpFormValidate($(this).val(),$(this).data("rule"),$(this))===false){$(this).addClass("is-invalid");my.backToDom($(this));issuccess=false;layer.msg("请按照指定格式填写表单");return false}}if($(this).attr("required")!==undefined&&my.isEmpty($(this).val())&&!$(this).is(":hidden")){$(this).addClass("is-invalid");my.backToDom($(this));issuccess=false;layer.msg("表单未填写完整");return false}});return issuccess},get_current_form_obj:function(ele){var _obj=null;$("form").each(function(i){var obj=$(this).find(ele);if(obj.length===1){_obj=$(this)}});return _obj},query:function(name,url){if(!url){url=window.location.href}name=name.replace(/[\[\]]/g,"\\$&");var regex=new RegExp("[?&/]"+name+"([=/]([^&#/?]*)|&|#|$)"),results=regex.exec(url);if(!results){return null}if(!results[2]){return""}return decodeURIComponent(results[2].replace(/\+/g," "))},fixurl:function(url){if(url.substr(0,1)!=="/"){var r=new RegExp("^(?:[a-z]+:)?//","i");if(!r.test(url)){url="/"+url}}return url},open:function(url,title,options){title=options&&options.title?options.title:(title?title:"信息");url=my.fixurl(url);url=url+(url.indexOf("?")>-1?"&":"?")+"dialog=1";options=options?options:{};options.area==="full"&&(options.area=["100%","100%"]);var area=my.window.width()>893?["893px","600px"]:(my.window.width()>480?[my.window.width()*0.9+"px","95%"]:"auto");var defaultOptions={type:2,title:"信息",shadeClose:false,shade:[0.8,"#393D49"],maxmin:true,area:area,moveOut:true,offset:"auto",content:url,zIndex:layer.zIndex,closeRefresh:false,closeCallback:false};if(typeof(set_open_area)==="function"){var setAreaVal=set_open_area();if((setAreaVal!==undefined)&&(setAreaVal instanceof Array)){options["area"]=setAreaVal}}options.title=title;options=$.extend({},defaultOptions,options);options=$.extend({success:function(layero,index){try{var bodyDom=layer.getChildFrame("body",index);var iframeWin=window[layero.find("iframe")[0]["name"]];my.fn=iframeWin;my.obj=$(bodyDom)}catch(err){}var that=this;$(layero).data("callback",that.callback);layer.setTop(layero);try{var frame=layer.getChildFrame("html",index);var layerfooter=frame.find(".layer-footer");my.layerfooter(layero,index,that);if(layerfooter.length>0){var MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(MutationObserver){var target=layerfooter[0];var observer=new MutationObserver(function(mutations){my.layerfooter(layero,index,that);mutations.forEach(function(mutation){})});var config={attributes:true,childList:true,characterData:true,subtree:true};observer.observe(target,config)}}}catch(e){}if($(layero).height()>$(window).height()){layer.style(index,{top:0,height:$(window).height()})}},end:function(index){if(typeof(options.closeCallback)==="function"){options.closeCallback()}if(typeof(close_layer)=="function"){if(close_layer(index)===false){return false}}if(options.closeRefresh){my.load(null,false)}}},options?options:{});if($(window).width()<480||(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&top.$(".tab-pane.active").length>0)){var winWidth=my.window.width()-35;var winHeight=my.window.height()*0.9;options.area=[winWidth+"px",winHeight+"px"];options.offset="auto"}var myLayerLastIndex=layer.open(options);my.setData("layerLastIndex",myLayerLastIndex);return myLayerLastIndex},load:function(url,setpage=true){url=url?url:window.location.href;window.location.href=url},close:function(data){var index=parent.layer.getFrameIndex(window.name);var callback=parent.$("#layui-layer"+index).data("callback");parent.layer.close(index);if(typeof callback==="function"){callback.call(undefined,data)}},layerfooter:function(layero,index,that){var frame=layer.getChildFrame("html",index);var layerfooter=frame.find(".layer-footer");if(layerfooter.length>0){$(".layui-layer-footer",layero).remove();var footer=$("<div />").addClass("layui-layer-btn layui-layer-footer");footer.html(layerfooter.html());if($(".row",footer).length===0){$(">",footer).wrapAll("<div class='row'></div>")}footer.insertAfter(layero.find(".layui-layer-content"));footer.on("click",".btn",function(){if($(this).hasClass("disabled")||$(this).parent().hasClass("disabled")){return}var index=footer.find(".btn").index(this);$(".btn:eq("+index+")",layerfooter).trigger("click")});footer.on("click","[type=submit]",function(){var form=$(".btn:eq("+$(this).index()+")",layerfooter)[0].form;$(form).find(":submit").click()});var titHeight=layero.find(".layui-layer-title").outerHeight()||0;var btnHeight=layero.find(".layui-layer-btn").outerHeight()||0;$("iframe",layero).height(layero.height()-titHeight-btnHeight)}if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){var titHeight=layero.find(".layui-layer-title").outerHeight()||0;var btnHeight=layero.find(".layui-layer-btn").outerHeight()||0;$("iframe",layero).parent().css("height",layero.height()-titHeight-btnHeight);$("iframe",layero).css("height","100%")}},inArray:function(str,array){return array.includes(str)},regExpFormValidate:function(value,reg_exp_str,ele=""){if(my.isEmpty(reg_exp_str)){return true}var regExp={"email":"^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$","url":"[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(/.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+/.?","mobile":"^[1][3,4,5,7,8,9][0-9]{9}$","id_card":"^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$","id_card_15":"^[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}$","strong_pwd_two":"^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-._]).{8,}$","strong_pwd":"^(?![a-zA-Z]+$)(?![A-Z0-9]+$)(?![A-Z\\W_!@#$%^&*`~()-+=]+$)(?![a-z0-9]+$)(?![a-z\\W_!@#$%^&*`~()-+=]+$)(?![0-9\\W_!@#$%^&*`~()-+=]+$)[a-zA-Z0-9\\W_!@#$%^&*`~()-+=]{8,}$","password":"(?=.*?[a-z])(?=.*?[A-Z])(?=.*?[0-9]){8,}","date":"^\d{4}-\d{1,2}-\d{1,2}","time":"^([01]\d|2[0-3])(:[0-5]\d){1,2}$","zh_cn":"^[\u4e00-\u9fa5]{0,}$","en_num":"^[A-Za-z0-9]+$","en_num_underline":"^[A-Za-z0-9_.\/\]+$","en":"^[A-Za-z]+$","en_underline":"^[a-zA-Z_]{1,}$","cn_en_num":"^[\u4E00-\u9FA5A-Za-z0-9]+$","cn_en_num_underline":"^[\u4E00-\u9FA5A-Za-z0-9_]+$","number":"^\d+$","ip":"^(d{1,2}|1dd|2[0-4]d|25[0-5]).(d{1,2}|1dd|2[0-4]d|25[0-5]).(d{1,2}|1dd|2[0-4]d|25[0-5]).(d{1,2}|1dd|2[0-4]d|25[0-5])$","zipcode":"^\d{6}$",};var checkArr=reg_exp_str.split("|");if(my.isEmpty(value)){if($.inArray("required",checkArr)>-1){return false}else{return true}}var result=false;$.each(checkArr,function(i,rule_item){if(my.isEmpty(rule_item)){return true}if(typeof(regExp[rule_item])!="undefined"){var regExpObj=new RegExp(regExp[rule_item]);if(regExpObj.test(value)===false){result=false;return false}else{result=true}}else{if("required"==rule_item){result=true;return true}if("json"==rule_item){var temp_json=value.split(/[\s\n]/).join("");if(my.isJsonString(temp_json)){result=true;return true}else{result=false;return false}}var bracket=rule_item.match(/\(([^)]*)\)/);if(!bracket){result=false;return false}var rule_type=rule_item.replace(bracket[0],"");var rule_append=bracket[1];switch(rule_type){case"remote":var check_data={};check_data[$(ele).attr("name")]=value;var add_data=$(ele).data("join");if(add_data){var tempJson={};if(my.isJsonString(add_data)){tempJson=JSON.parse(add_data)}else{if(my.isJSON(add_data)){tempJson=add_data}else{try{tempJson=window[add_data](add_data)}catch(e){}}}my.mergeJSON(check_data,tempJson)}my.ajax(rule_append,check_data,function(res){if(typeof res=="string"){res=JSON.parse(res)}if(res.check==true||res.check=="true"){result=true;return true}else{layer.msg(res.message);result=false;return false}},function(err){});break;case"length":var len_arr=rule_append.split("~");if(len_arr[0]){if(value.length<len_arr[0]){result=false;return false}}if(len_arr[1]){if(value.length>len_arr[1]){result=false;return false}}break;default:}}});return result},getdivform:function(ele,return_null=false){var json_data={};$(ele).find("input,textarea,select").each(function(index,elenode){if(return_null){if($(elenode).attr("type")=="radio"||$(elenode).attr("type")=="checkbox"){json_data[$(elenode).attr("name")]=$("input[name='"+$(elenode).attr("name")+"']:checked").val()}else{json_data[$(elenode).attr("name")]=$(elenode).val()}}else{if($(elenode).attr("name")!==undefined&&!my.isEmpty($(elenode).attr("name"))&&!my.isEmpty($(elenode).val())){if($(elenode).attr("type")=="radio"||$(elenode).attr("type")=="checkbox"){json_data[$(elenode).attr("name")]=$("input[name='"+$(elenode).attr("name")+"']:checked").val()}else{json_data[$(elenode).attr("name")]=$(elenode).val()}}}});return json_data},ajax:function(url,data,successFun,errorFun,reqtype){reqtype=reqtype?(reqtype.toUpperCase()=="GET"?"GET":"POST"):"POST";var index=layer.msg("正在处理中……",0);var contentTypeVal="application/x-www-form-urlencoded";var processDataVal=true;if(data.__proto__.hasOwnProperty("append")){contentTypeVal=false;processDataVal=false}var headerJson={};var hradParam=$("#form_headers_ajax").serializeArray();if(hradParam){for(var i=0;i<hradParam.length;i++){headerJson[hradParam[i].name]=hradParam[i].value}}$.ajax({async:true,cache:false,url:url,type:reqtype,timeout:30000,contentType:contentTypeVal,processData:processDataVal,headers:headerJson,data:data,dataType:"json",error:function(jqXHR,textStatus,errorThrown){layer.close(index);var errorRes=my.delhtmltag(jqXHR.responseText);try{if(typeof(errorRes)=="string"){errorRes=JSON.parse(errorRes)}}catch(err){}if(typeof errorRes.message!="undefined"){layer.msg(errorRes.message)}else{layer.msg(errorRes)}errorFun&&errorFun(errorRes.message,errorRes)},success:function(succ){layer.close(index);if(succ.code>299){}successFun&&successFun(succ)}})},delhtmltag:function(str){try{str=str?str.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""):"";str=str?str.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi,""):"";str=str?$(str).text():""}catch(err){}return str},isEmpty:function(obj){if(typeof obj=="undefined"||obj==null||obj==""||obj.length==0||(!/[^(^\s*)|(\s*$)]/.test(obj))||(my.getType(obj)=="Object"&&Object.keys(obj).length==0)||(my.getType(obj)=="string"&&["{}","[]"].includes(obj))){return true}else{return false}},isJSON:function(target){return typeof target=="object"&&target.constructor==Object},isJsonString:function(str){if(typeof str=="string"){try{var obj=JSON.parse(str);if(typeof obj=="object"&&obj){return true}}catch(e){}}return false},mergeJSON:function(json1,json2,cover=true){if(cover){return $.extend(true,json1,json2)}else{return $.extend({},json1,json2)}},backToDom:function(domEle){$("html , body").animate({scrollTop:$(domEle).offset().top},800)},window:{width:function(){return $(window).width()},height:function(){return $(window).height()},},jsonToUrl:function(param,key,encode){if(param==null)return"";var paramStr="";var t=typeof(param);if(t=="string"||t=="number"||t=="boolean"){paramStr+=key+"="+((encode==null||encode)?encodeURIComponent(param):param)}else{for(var i in param){var k=key==null?i:key+(param instanceof Array?"["+i+"]":"."+i);paramStr+=((paramStr=="")?"?":"&")+my.jsonToUrl(param[i],k,encode)}}return paramStr},urlQuery:function(name,location,get_last){get_last=get_last?get_last:true;var url=location?location:window.location.href;var splitIndex=url.indexOf("?")+1;var paramStr=url.substr(splitIndex,url.length);var arr=paramStr.split("&");var lastVal;var allParamData={};for(var i=0;i<arr.length;i++){var kv=arr[i].split("=");if(name){if(kv[0]==name){if(get_last){lastVal=kv[1]}else{return kv[1]}}}else{if(lastVal==undefined){lastVal={}}lastVal[kv[0]]=kv[1]}}return lastVal},setUrlParam:function(name,value,location){var url=location?location:window.location.href;var splitIndex=url.indexOf("?")+1;var paramStr=url.substr(splitIndex,url.length);var url_param={};var newUrl=url.substr(0,splitIndex);var arr=paramStr.split("&");for(var i=0;i<arr.length;i++){var kv=arr[i].split("=");if(kv[0]==name){if(url_param[name]==undefined){url_param[name]=value;newUrl+=kv[0]+"="+value}}else{if(kv[1]!=undefined){newUrl+=kv[0]+"="+kv[1]}}if(i!=arr.length-1){newUrl+="&"}}if(newUrl.indexOf(name)<0){newUrl+=splitIndex==0?"?"+name+"="+value:"&"+name+"="+value}return((newUrl==name+"=")||(newUrl=="?"+name+"=")||(newUrl=="&"+name+"="))?url:newUrl},backToTop:function(elementName,toTopVal){try{if(typeof elementName=="undefined"){$("body").append("<div class=\"my-backtotop\">&#8679;</div>");elementName=$(".my-backtotop");$(elementName).css({"position":"fixed","bottom":"50px","right":"40px","z-index":"9999","width":"33px","height":"33px","text-align":"center","text-decoration":"none","line-height":"32px","background-color":"rgba(0, 0, 0, 0.75)","font-size":"21px","color":"#00abff","border-radius":"50%","opacity":0.4,"display":'none',});$(elementName).hover(function(){$(this).css({opacity:0.8})})}var $el=$(elementName),offset=100;var scrollDom=document.body;window.addEventListener("scroll",function(event){scrollDom=event.target;const top=document.documentElement.scrollTop||document.body.scrollTop||$(window).scrollTop()||event.target.scrollTop;if(top>offset){$el.fadeIn()}else{$el.fadeOut()}},true);$el.on("click",function(){$("html, body").animate({scrollTop:0},700);$(scrollDom).animate({scrollTop:0},700)})}catch(err){console.log("err",err)}},debounce:function(fun,delay=500){return function(args){let that=this;let _args=args;clearTimeout(fun.id);fun.id=setTimeout(function(){fun.call(that,_args)},delay)}},throttle:function(fun,delay=1000){let last,deferTimer;return function(args){let that=this;let _args=arguments;let now=+new Date();if(last&&now<last+delay){clearTimeout(deferTimer);deferTimer=setTimeout(function(){last=now;fun.apply(that,_args)},delay)}else{last=now;fun.apply(that,_args)}}},urlEnCode:function(url_str,type="de"){if(!url_str){return""}if(type&&type.toUpperCase()=="DE"){return decodeURIComponent(url_str)}else{return encodeURIComponent(url_str)}},escape2Html:function(str){if(my.isEmpty(str)){return str}var arrEntities={"lt":"<","gt":">","nbsp":" ","amp":"&","quot":"\""};return str.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(all,t){return arrEntities[t]})},noticeTool:function(elementName){try{if(typeof elementName=="undefined"){$("body").append("<div class=\"my-notice-tool\">笔</div>");elementName=$(".my-notice-tool");$(elementName).css({"position":"fixed","bottom":"80px","right":"40px","z-index":"9999","width":"33px","height":"33px","text-align":"center","text-decoration":"none","line-height":"32px","background-color":"rgba(0, 0, 0, 0.75)","font-size":"21px","color":"#00abff","border-radius":"50%","display":"black","opacity":0.8})}var $el=$(elementName);$el.on("click",function(){let display=$(".my-notice-tool-content").css("display");if(display=="none"){$(".my-notice-tool-content").show()}else{$(".my-notice-tool-content").hide()}});$("body").append("<div class=\"my-notice-tool-content\"><textarea name=\"\" class=\"my-notice-tool-textarea\" rows=\"3\" cols=\"20\" placeholder=\"小小笔记...\"></textarea></div>");$(".my-notice-tool-content").append("<style>.my-notice-tool-textarea{width:270px;height:95px;resize: none;padding:8px;font-size: 12px;}</style>");let toolName=$(".my-notice-tool-content");$(toolName).css({"position":"fixed","bottom":"80px","right":"80px","z-index":"9999","background":"#449d44","display":"none","border":" 2px solid #449d44"});$(".my-notice-tool-content").append("<style>.my-notice-tool-content::after{}</style>");$(".my-notice-tool-textarea").bind("input propertychange",function(){let noticeToolVal=$(".my-notice-tool-textarea").val();if(noticeToolVal.length>0){sessionStorage.setItem("my_notice_tool_textarea_value",noticeToolVal)}});$(".my-notice-tool-textarea").val(sessionStorage.getItem("my_notice_tool_textarea_value"))}catch(err){console.log("err",err)}},tips:function(){var tipElement=null;$("[data-tips]").unbind();$("[data-tips]").hover(function(){$(this).attr("title","");tipElement=$("#mytip");if($(tipElement).length<1){tipElement=$("<div id=\"mytip\"></div>");$("body").append(tipElement)}let allowType=["top","bottom","left","right","track"];let tip=$(this).data("tips");let tip_type=$(this)["0"].dataset.tips;if(tip=="")return;if(tip.indexOf("#")===0){tip=$(tip).html()}else{tip=tip.replace(/\\n/,"<br>");tip=tip.replace(/\n/,"<br>")}tipElement.html(tip);var arrowClass=allowType.indexOf(tip_type)!=-1?tip_type:"track";if(arrowClass=="track"){tipElement.addClass("track")}else{tipElement.removeClass("track");tipElement.removeClass("top").removeClass("bottom").removeClass("left").removeClass("right");tipElement.addClass(arrowClass);var top=0,left=0;if(arrowClass=="top"){top=$(this).offset().top-tipElement.outerHeight()-5;left=$(this).offset().left+$(this).width()/2-tipElement.outerWidth()/2}else if(arrowClass=="bottom"){top=$(this).offset().top+$(this).height()+5;left=$(this).offset().left+$(this).width()/2-tipElement.outerWidth()/2}else if(arrowClass=="left"){top=$(this).offset().top+$(this).height()/2-tipElement.outerHeight()/2;left=$(this).offset().left-tipElement.outerWidth()-5}else if(arrowClass=="right"){top=$(this).offset().top+$(this).height()/2-tipElement.outerHeight()/2;left=$(this).offset().left+$(this).width()+5}tipElement.css({"top":Math.round(top)+"px","left":Math.round(left)+"px",});tipElement.stop(false,true).show(500)}},function(){tipElement&&tipElement.stop(false,true).hide(300)}).mousemove(function(e){if(typeof tipElement.hasClass==undefined||!tipElement.hasClass("track"))return;e=e||window.event;var x=e.pageX||e.clientX+document.body.scroolLeft;var y=e.pageY||e.clientY+document.body.scrollTop;var top=y+10;var left=x+5;tipElement.css("top",top+"px");tipElement.css("left",left+"px");tipElement.stop(false,true).show(500)}).each(function(){$(this).data("tips",$(this).attr("title"))})},stop_jump:function(){$("a.stop_jump").click(function(e){if(e&&e.preventDefault){e.preventDefault()}else{window.event.returnValue=false}var href=$(this).attr("href");if(href=="#"||href=="javascript:;"){return false}my.ajax(href,{},function(res){if(typeof res=="string"){res=JSON.parse(res)}if(res.code==200||res.code==0){layer.msg(res.message)}else{layer.msg(res.message)}res.wait=res.wait?res.wait:3;if(typeof(res.url)!="undefined"){setInterval(function(){window.location.href=res.url},res.wait*1000)}},function(err){});return false})},multiple_img_preview:function(inputELe,previewBoxEle,multiple=false,callback){let inputFile=document.querySelector(inputELe),wrapper=document.querySelector(previewBoxEle);var inputName=$(inputFile).data("name")||"file[]";var inputValueField=$(inputFile).data("value-field")||"url";console.log("inputValueField",inputValueField);var $previewStyle=$("<style type=\"text/css\">.my-preview-waterfall{width:150px;float:left;position:relative;padding:.3em;margin:0 .125em 1em;-moz-page-break-inside:avoid;-webkit-column-break-inside:avoid;break-inside:avoid;background:white;-moz-box-shadow:0 1px 3px 0 rgba(0,0,0,0.12),0 1px 2px 0 rgba(0,0,0,0.24);-webkit-box-shadow:0 1px 3px 0 rgba(0,0,0,0.12),0 1px 2px 0 rgba(0,0,0,0.24);box-shadow:0 1px 3px 0 rgba(0,0,0,0.12),0 1px 2px 0 rgba(0,0,0,0.24)}.my-preview-waterfall img{width:100%;height:100px!important;padding-bottom:.3em;border-bottom:1px solid #ccc}.my-preview-waterfall .my-file-name{font-size:10px;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical}.my-preview-waterfall .my-close{font-size:14px;top:8px;position:absolute;right:8px;background:red;color:#fff;padding:5px;border-radius:3px;line-height:10px;cursor:pointer}</style>");$($("head")[0]).append($previewStyle);var preview=function(files,use_callback=false){if(use_callback==true){var imgStr="<div class=\"my-preview-waterfall\"><div class=\"my-close\">删除</div><img src=\""+files["url"]+"\" alt=\"\"><span class=\"my-file-name\" title=\""+files.name+"\">"+files.name+"</span><input type=\"text\" name=\""+inputName+"\" value=\""+files[inputValueField]+"\" style=\"display:none;\" /></div>";$(wrapper).append(imgStr);$(".my-close").click(function(){$(this).parent().remove()})}else{Object.keys(files).forEach(function(file){let fileReader=new FileReader();fileReader.readAsDataURL(files[file]);fileReader.onload=function(evt){var objUrl=null;if(window.createObjectURL!=undefined){objUrl=window.createObjectURL(files[file])}else if(window.URL!=undefined){objUrl=window.URL.createObjectURL(files[file])}else if(window.webkitURL!=undefined){objUrl=window.webkitURL.createObjectURL(files[file])}var imgStr="<div class=\"my-preview-waterfall\"><div class=\"my-close\">删除</div><img src=\""+objUrl+"\" alt=\"\"><span class=\"my-file-name\" title=\""+files[file].name+"\">"+files[file].name+"</span><input type=\"text\" name=\""+inputName+"\" value=\""+evt.target.result+"\" style=\"display:none;\" /></div>";$(wrapper).append(imgStr);$(".my-close").click(function(){$(this).parent().remove()})}})}};$(inputELe).change(function(e){let multiple=$(inputELe).attr("multiple");let files=e.target.files;if(!multiple){$(wrapper).empty()}if(typeof callback=="function"){Object.keys(files).forEach(function(file){callback(files[file]).then(res=>{if(res.is_done===true){res["name"]=my.isEmpty(res["name"])?(files[file].name||"未命名"):res["name"];preview(res,true)}else{layer.msg(files[file].name+":"+(my.isEmpty(res["msg"])?"上传失败":res["msg"]))}}).catch(error=>{layer.msg(files[file].name+" 上传失败");console.log("error",error)})})}else{preview(files)}});$(".my-close").click(function(){$(this).parent().remove()})},listenFileChangeURL:function(inputFileEle,successFun){$(inputFileEle).bind("input propertychange",function(ele){var url=window.URL||window.webkitURL||window.mozURL;var file=ele.target.files[0];var file_src=url.length>0?url.createObjectURL(file):($(inputFileEle).val()||ele.target.result);successFun&&successFun(file_src,ele.target)})},getObjLength:function(obj){if(my.isJson(obj)){return Object.keys(obj).length}switch(my.getType(obj)){case"Array":return obj["length"];case"Object":return Object.keys(obj).length;default:return 0}},getType:function(data){let type=typeof data;if(type!=="object"){return type}return Object.prototype.toString.call(data).replace(/^\[object (\S+)\]$/,"$1")},closeFlavr:function(flavrEle){try{flavrEle.close()}catch(err){}},closeAllFlavr:function(){$("body").find(".flavr-container.shown").remove()},timestamp:function(dateString=""){const time=dateString?parseInt((new Date(dateString)).getTime().toString().substr(0,10)):parseInt((new Date()).getTime().toString().substr(0,10));return time},timestampToDate:function(timestamp,format="y-m-d"){var date_str=timestamp?parseInt(timestamp.toString().substr(0,10)):parseInt((new Date()).getTime().toString().substr(0,10));var date=new Date(date_str*1*1000);format=format?format:"y-m-d";var year=date.getFullYear().toString();var month=date.getMonth()*1+1;var day=date.getDate();var hour=date.getHours();var minute=date.getMinutes();var second=date.getSeconds();var resutl_time=format;if(format.indexOf("y")>-1){resutl_time=resutl_time.replace("y",year)}if(format.indexOf("m")>-1){resutl_time=resutl_time.replace("m",(month>9?month:"0"+month).toString())}if(format.indexOf("d")>-1){resutl_time=resutl_time.replace("d",(day>9?day:"0"+day).toString())}if(format.indexOf("h")>-1){resutl_time=resutl_time.replace("h",(hour>9?hour:"0"+hour).toString())}if(format.indexOf("i")>-1){resutl_time=resutl_time.replace("i",(minute>9?minute:"0"+minute).toString())}if(format.indexOf("s")>-1){resutl_time=resutl_time.replace("s",(second>9?second:"0"+second).toString())}return resutl_time},openFullscreen:function(element){try{if(element.requestFullscreen){element.requestFullscreen()}else if(element.mozRequestFullScreen){element.mozRequestFullScreen()}else if(element.msRequestFullscreen){element.msRequestFullscreen()}else if(element.webkitRequestFullscreen){element.webkitRequestFullScreen()}}catch(error){}},exitFullScreen:function(){try{if(document.exitFullscreen){document.exitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExiFullscreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}catch(error){}},dataURLtoFile:function(dataurl,filename){var arr=dataurl.split(","),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n)}return new File([u8arr],filename,{type:mime})},getAnchorPoint:function(name){var getTab=window.location.hash;var args=getTab.substring(1).split("&");for(var i=0,len=args.length;i<len;i++){var hashItem=args[i];var item=hashItem.split("=");if(item["0"]==name){return item["1"]||""}}return""},formatJson:function(jsonObj){var reg=null;var formatted="";var pad=0;var PADDING="    ";var jsonString=null;if(Object.prototype.toString.call(jsonObj)!=="[object String]"){try{jsonString=JSON.stringify(jsonObj)}catch(error){return"json数据格式有误:"+error}}else{try{jsonObj=jsonObj.replace(/(\')/g,"\"");jsonString=JSON.stringify(JSON.parse(jsonObj))}catch(error){return"json数据格式有误:"+error}}if(!jsonString){return jsonString}var _index=[];var _indexStart=null;var _indexEnd=null;var jsonArray=[];jsonString=jsonString.replace(/([\{\}])/g,"\r\n$1\r\n");jsonString=jsonString.replace(/([\[\]])/g,"\r\n$1\r\n");jsonString=jsonString.replace(/(\,)/g,"$1\r\n");jsonString=jsonString.replace(/(\r\n\r\n)/g,"\r\n");jsonString=jsonString.replace(/\r\n\,/g,",");jsonArray=jsonString.split("\r\n");jsonArray.forEach(function(node,index){var num=node.match(/\"/g)?node.match(/\"/g).length:0;if(num%2&&!_indexStart){_indexStart=index}if(num%2&&_indexStart&&_indexStart!=index){_indexEnd=index}if(_indexStart&&_indexEnd){_index.push({start:_indexStart,end:_indexEnd});_indexStart=null;_indexEnd=null}});_index.reverse().forEach(function(item,index){var newArray=jsonArray.slice(item.start,item.end+1);jsonArray.splice(item.start,item.end+1-item.start,newArray.join(""))});jsonString=jsonArray.join("\r\n");jsonString=jsonString.replace(/\:\r\n\{/g,":{");jsonString=jsonString.replace(/\:\r\n\[/g,":[");jsonArray=jsonString.split("\r\n");jsonArray.forEach(function(item,index){var i=0;var indent=0;var padding="";if(item.match(/\{$/)||item.match(/\[$/)){indent+=1}else if(item.match(/\}$/)||item.match(/\]$/)||item.match(/\},$/)||item.match(/\],$/)){if(pad!==0){pad-=1}}else{indent=0}for(i=0;i<pad;i++){padding+=PADDING}formatted+=padding+item+"\r\n";pad+=indent});return formatted.trim()},urlToObject:function urlToObject(url){if(my.isEmpty(url))return{};var urlObject={};var urlString;var urlArray;if(/\?/.test(url)){urlString=url.substring(url.indexOf("?")+1)}try{urlArray=urlString.split("&")}catch(error){urlArray=new Array(url)}for(var i=0,len=urlArray.length;i<len;i++){var urlItem=urlArray[i];var item=urlItem.split("=");urlObject[item[0]]=item[1]}return urlObject},objectToUrl:function(param,key){var paramStr="";if(param instanceof String||param instanceof Number||param instanceof Boolean){paramStr+="&"+key+"="+encodeURIComponent(param)}else{$.each(param,function(i){var k=key==null?i:key+(param instanceof Array?"["+i+"]":"."+i);paramStr+="&"+parseParam(this,k)})}return paramStr.substr(1)},sleep:function(timerOrFun,timeoutTimer=10){var start=new Date().getTime();while(true){if(typeof(timerOrFun)=="function"){if(timerOrFun()===true){break}if(new Date().getTime()-start>timeoutTimer*1000){break}}if(typeof(timerOrFun)=="number"){if(new Date().getTime()-start>timerOrFun){break}}}return true},clone:function(data){var obj;if(Object.prototype.toString.call(data)==="[object Array]"){obj=[]}else if(Object.prototype.toString.call(data)==="[object Object]"){obj={}}else{return data}if(Object.prototype.toString.call(data)==="[object Array]"){for(var i=0,len=data.length;i<len;i++){obj.push(my.clone(data[i]))}}else if(Object.prototype.toString.call(data)==="[object Object]"){for(var key in data){obj[key]=my.clone(data[key])}}return obj},observer:function(obj,callback){var args=arguments;if(typeof(callback)!="function"){throw new Error("最后一个参数应该是回调函数，用于返回监听数据变化");}var can_call_callback=args.length<=2;if(!["[object Object]","[object Array]"].includes(Object.prototype.toString.call(obj))){var lisenObj={};Object.defineProperty(window,[obj],{set:function(val){let _old_data=lisenObj[obj]||undefined;lisenObj[obj]=val;can_call_callback&&callback&&callback(val,_old_data,obj)},get:function(){return lisenObj[obj]}})}else{function overrideArrayProto(array,callback){var originalProto=Array.prototype,overrideProto=Object.create(Array.prototype),result;["push","pop","shift","unshift","short","reverse","splice"].forEach((method)=>{Object.defineProperty(overrideProto,method,{value:function(){var oldVal=this.slice();result=originalProto[method].apply(this,arguments);my.observer(this,callback);callback&&callback(this,oldVal,callback);return result}})});array.__proto__=overrideProto}function isObjectValueEqual(a,b){var aProps=Object.getOwnPropertyNames(a);var bProps=Object.getOwnPropertyNames(b);if(aProps.length!==bProps.length){return false}for(var i=0;i<aProps.length;i++){var propName=aProps[i],propA=a[propName],propB=b[propName];if(!b.hasOwnProperty(propName))return false;if((propA instanceof Object)){if(!isObjectValueEqual(propA,propB)){return false}}else if(propA!==propB){return false}}return true}if(Object.prototype.toString.call(obj)==="[object Array]"){overrideArrayProto(obj)}var oldObj=my.clone(obj);Object.keys(obj).forEach((key)=>{let oldVal=obj[key];Object.defineProperty(obj,key,{configurable:true,enumerable:true,get(){return oldVal},set(val){if(Object.prototype.toString.call(val)==="[object Object]"){my.observer(val,callback,true)}oldObj[key]=oldVal;oldVal=val;can_call_callback&&callback&&callback(obj,oldObj)}});if(["[object Object]","[object Array]"].includes(Object.prototype.toString.call(oldVal))){my.observer(oldVal,callback,true);if(!isObjectValueEqual(obj,oldObj)){can_call_callback&&callback&&callback(obj,oldObj)}}})}},getArgs:function(attr_name){var sc=document.getElementsByTagName("script");var attr_val;$.each(sc,function(i,val){attr_val=val.getAttribute(attr_name);if(attr_val){return false}});return attr_val}};window.my=my;var my_init=my.getArgs("my-init");if(my_init&&typeof(my_init)!=="undefined"){if(my_init=="true"){my.init()}else{try{var fun_arr=my_init.split(",");for(let index in fun_arr){my[fun_arr[index]]()}}catch(err){}}}}(jQuery);
